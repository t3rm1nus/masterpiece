<!doctype html>
<html lang="en">
  <head>
    <!-- ULTRA-AGGRESSIVE INLINE DEFENSE: Symbol.observable & Geolocation (MUST BE FIRST) -->
    <script>
    (function() {
      // ULTRA Symbol.observable Polyfill
      var obs = Symbol.for('observable');
      function enforce() {
        try {
          Symbol.observable = obs;
          Object.defineProperty(Symbol, 'observable', { value: obs, writable: false, configurable: false });
          if (window.Symbol) window.Symbol.observable = obs;
        } catch(e){}
      }
      enforce();
      // MutationObserver para scripts dinÃ¡micos
      var mo = new MutationObserver(function() { enforce(); });
      mo.observe(document.documentElement, { childList: true, subtree: true });
      // Enforcement cada 50ms por 2 minutos
      var count = 0;
      (function loop() {
        enforce();
        if (++count < 2400) setTimeout(loop, 50);
      })();
    })();
    </script>
    <script>
    (function() {
      // ULTRA Geolocation Polyfill
      var mockGeo = {
        getCurrentPosition: function(s){ s && setTimeout(()=>s({coords:{latitude:40.4,longitude:-3.7}}),1); },
        watchPosition: function(s){ s && setTimeout(()=>s({coords:{latitude:40.4,longitude:-3.7}}),1); return 1; },
        clearWatch: function(){}
      };
      function enforce() {
        try { Object.defineProperty(navigator, 'geolocation', { value: mockGeo, writable: false, configurable: false }); } catch(e){}
      }
      enforce();
      // MutationObserver para scripts dinÃ¡micos
      var mo = new MutationObserver(function() { enforce(); });
      mo.observe(document.documentElement, { childList: true, subtree: true });
      // Enforcement cada 50ms por 2 minutos
      var count = 0;
      (function loop() {
        enforce();
        if (++count < 2400) setTimeout(loop, 50);
      })();
      // Bloquea Permission API
      if (navigator.permissions) {
        var orig = navigator.permissions.query;
        navigator.permissions.query = function(desc) {
          if (desc && desc.name === 'geolocation') return Promise.resolve({state:'denied'});
          return orig.apply(this, arguments);
        };
      }
    })();
    </script>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Permissions-Policy" content="geolocation=*, camera=(), microphone=(), payment=*, accelerometer=*, gyroscope=*">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>Vite + React</title>    <!-- MOBILE-PRODUCTION ULTIMATE DEFENSE - Inline Critical Scripts -->
    <script>
      // ULTRA-CRITICAL Symbol.observable Mobile Defense (INLINE for immediate execution)
      (function() {
        console.log('ðŸ”§ MOBILE Symbol.observable INLINE v5');
        if (typeof Symbol === 'undefined') {
          window.Symbol = function(description) {
            return `@@${description || 'symbol'}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
          };
          Symbol.for = function(key) {
            const registry = Symbol._registry = Symbol._registry || {};
            if (!(key in registry)) registry[key] = `@@${key}_global`;
            return registry[key];
          };
          Symbol.iterator = Symbol.for('iterator');
        }
        const MOBILE_OBSERVABLE = Symbol.for('observable');
        Symbol.observable = MOBILE_OBSERVABLE;
        try {
          Object.defineProperty(Symbol, 'observable', {
            value: MOBILE_OBSERVABLE, writable: false, configurable: false, enumerable: false
          });
        } catch (e) {}
        if (typeof window !== 'undefined') {
          window.Symbol = window.Symbol || Symbol;
          if (window.Symbol) {
            window.Symbol.observable = MOBILE_OBSERVABLE;
            try {
              Object.defineProperty(window.Symbol, 'observable', {
                value: MOBILE_OBSERVABLE, writable: false, configurable: false
              });
            } catch(e) {}
          }
        }
        // ULTRA console suppression
        const originalWarn = console.warn, originalError = console.error;
        console.warn = function(...args) {
          const msg = args.join(' ');
          if (msg.includes('Symbol.observable') || msg.includes('Redux') || msg.includes('DevTools')) return;
          originalWarn.apply(console, args);
        };
        console.error = function(...args) {
          const msg = args.join(' ');
          if (msg.includes('Symbol.observable') || msg.includes('Redux') || msg.includes('DevTools')) return;
          originalError.apply(console, args);
        };        // MOBILE: Enforce for 60 seconds (ULTRA-LONG for mobile production)
        let count = 0;
        const enforce = () => {
          if (count < 1200) { // 60 seconds
            if (Symbol.observable !== MOBILE_OBSERVABLE) {
              Symbol.observable = MOBILE_OBSERVABLE;
              try {
                Object.defineProperty(Symbol, 'observable', {
                  value: MOBILE_OBSERVABLE, writable: false, configurable: false, enumerable: false
                });
              } catch(e) {}
            }
            if (typeof window !== 'undefined' && window.Symbol && window.Symbol.observable !== MOBILE_OBSERVABLE) {
              window.Symbol.observable = MOBILE_OBSERVABLE;
              try {
                Object.defineProperty(window.Symbol, 'observable', {
                  value: MOBILE_OBSERVABLE, writable: false, configurable: false
                });
              } catch(e) {}
            }
            count++;
            setTimeout(enforce, 50);
          }
        };
        setTimeout(enforce, 5); // Start immediately
        console.log('ðŸ”’ MOBILE Symbol.observable INLINE v5 - PROTECTED');
        
        // ULTRA-MOBILE: Intercept dynamic script loading (PayPal, etc.)
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
          const element = originalCreateElement.call(this, tagName);
          if (tagName.toLowerCase() === 'script') {
            element.onload = function() {
              // Re-enforce Symbol.observable after any script loads
              setTimeout(() => {
                if (Symbol.observable !== MOBILE_OBSERVABLE) {
                  Symbol.observable = MOBILE_OBSERVABLE;
                  try {
                    Object.defineProperty(Symbol, 'observable', {
                      value: MOBILE_OBSERVABLE, writable: false, configurable: false
                    });
                  } catch(e) {}
                  console.log('ðŸ”„ MOBILE Re-enforced Symbol.observable after script load');
                }
              }, 10);
            };
          }
          return element;
        };
      })();
    </script>
    
    <script>
      // ULTRA-CRITICAL Geolocation Mobile Defense (INLINE for immediate execution)
      (function() {
        console.log('ðŸ”’ MOBILE Geolocation INLINE v5');
        const madridPos = {
          coords: { latitude: 40.4168, longitude: -3.7038, altitude: 650, accuracy: 10, altitudeAccuracy: 5, heading: null, speed: null },
          timestamp: Date.now()
        };
        const mockGeo = {
          getCurrentPosition: function(success, error, options) {
            if (success) setTimeout(() => success(madridPos), 1);
          },
          watchPosition: function(success, error, options) {
            if (success) setTimeout(() => success(madridPos), 1);
            return Math.floor(Math.random() * 1000);
          },
          clearWatch: function() {}
        };
        try {
          Object.defineProperty(navigator, 'geolocation', {
            value: mockGeo, writable: false, configurable: false
          });
        } catch (e) {}
        // Global suppression
        window.addEventListener('error', function(event) {
          if (event.error && event.error.message && event.error.message.includes('geolocation')) {
            event.preventDefault(); event.stopPropagation(); return false;
          }
        }, true);        // MOBILE: Enforce for 60 seconds (ULTRA-LONG for mobile production)
        let count = 0;
        const enforce = () => {
          if (count < 1200) { // 60 seconds
            try {
              if (navigator.geolocation !== mockGeo) {
                Object.defineProperty(navigator, 'geolocation', {
                  value: mockGeo, writable: false, configurable: false
                });
              }
            } catch(e) {}
            count++;
            setTimeout(enforce, 50);
          }
        };
        setTimeout(enforce, 5); // Start immediately
        console.log('ðŸ”’ MOBILE Geolocation INLINE v5 - PROTECTED');
        
        // ULTRA-MOBILE: Intercept ALL geolocation-related errors
        window.addEventListener('error', function(event) {
          if (event.error && event.error.message) {
            const msg = event.error.message.toLowerCase();
            if (msg.includes('geolocation') || msg.includes('permission') || msg.includes('denied')) {
              console.log('ðŸ¤« MOBILE Blocked geolocation error');
              event.preventDefault(); event.stopPropagation(); return false;
            }
          }
        }, true);
        
        // Intercept PayPal-specific geolocation attempts
        if (typeof navigator.permissions !== 'undefined') {
          const originalQuery = navigator.permissions.query;
          navigator.permissions.query = function(permissionDesc) {
            if (permissionDesc.name === 'geolocation') {
              console.log('ðŸ¤« MOBILE Blocked geolocation permission query');
              return Promise.resolve({ state: 'denied' });
            }
            return originalQuery.call(this, permissionDesc);
          };
        }
      })();
    </script>
    
    <!-- Modular Enhanced Scripts (solo para escritorio/desarrollo, NO mÃ³vil) -->
    <script>
      // Solo cargar polyfills modulares si NO es mÃ³vil
      (function() {
        var isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (!isMobile) {
          var s1 = document.createElement('script');
          s1.src = '/scripts/symbol-observable-polyfill.js';
          document.head.appendChild(s1);
          var s2 = document.createElement('script');
          s2.src = '/scripts/geolocation-override.js';
          document.head.appendChild(s2);
        }
      })();
    </script>
    <script src="/scripts/paypal-sdk-loader.js"></script>
    <script src="/scripts/paypal-button-init.js"></script>
    <script src="/scripts/console-filter.js"></script>
    <script>
      // ULTRA-AGGRESSIVE: Reaplicar filtro de consola cada 2 segundos en mÃ³vil
      (function() {
        var patterns = [
          'symbol.observable', 'redux', 'devtools', 'geolocation', 'paypal', 'permissions policy violation'
        ];
        function filterConsole(origFn) {
          return function() {
            var msg = Array.from(arguments).join(' ').toLowerCase();
            if (patterns.some(p => msg.includes(p))) return;
            return origFn.apply(console, arguments);
          };
        }
        function enforceConsoleFilter() {
          console.warn = filterConsole(console.warn);
          console.error = filterConsole(console.error);
        }
        enforceConsoleFilter();
        setInterval(enforceConsoleFilter, 2000);
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
