<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React</title>
    <!-- PayPal SDK Script -->
    <script
      src="https://www.paypal.com/sdk/js?client-id=BAArspW7KDEKg5gwovm8GgU9VyFznam0pK8opZaMXusHM_4ykQsGvLInGZv_vu5J9DDrqXIMHnlBmGWubw&components=hosted-buttons&disable-funding=venmo&currency=EUR" 
      crossorigin="anonymous" 
      async>
    </script>
    
    <!-- PayPal Button Initialization Script -->
    <script>
      document.addEventListener("DOMContentLoaded", (event) => {
        // Función para inicializar PayPal cuando esté disponible
        function initPayPal() {
          const container = document.getElementById("paypal-container-MRSQEQV646EPA");
          const wrapper = document.getElementById("paypal-button-wrapper");
          
          if (window.paypal && window.paypal.HostedButtons && container) {
            // Marcar como cargando
            if (wrapper) wrapper.classList.add('loading');
            
            // Limpiar el contenedor antes de renderizar
            container.innerHTML = '';
            
            try {
              paypal.HostedButtons({
                hostedButtonId: "MRSQEQV646EPA"
              })
              .render("#paypal-container-MRSQEQV646EPA")
              .then(function() {
                // Marcar como cargado cuando termine
                if (wrapper) {
                  wrapper.classList.remove('loading');
                  wrapper.classList.add('loaded');
                }
                console.log('Botón PayPal renderizado correctamente');
                
                // Intentar cambiar el color del texto después de renderizar
                setTimeout(function() {
                  try {
                    // Cambiar color del texto
                    const paypalElements = container.querySelectorAll('*');
                    paypalElements.forEach(function(element) {
                      element.style.color = '#000000';
                      element.style.setProperty('color', '#000000', 'important');
                      
                      // Aplicar espaciado ultra compacto
                      if (element.tagName === 'INPUT') {
                        element.style.marginBottom = '0.2rem';
                        element.style.paddingBottom = '0.2rem';
                      }
                      
                      if (element.classList && (
                          element.classList.contains('paypal-button') ||
                          element.classList.contains('paypal-button-color-gold') ||
                          element.getAttribute('data-funding-source') === 'paypal'
                      )) {
                        element.style.marginTop = '0.1rem';
                        element.style.paddingTop = '0';
                      }
                      
                      // Reducir line-height para todos los elementos
                      element.style.lineHeight = '1';
                      element.style.margin = '0.1rem 0';
                    });
                    
                    // Aplicar espaciado ultra específico al contenedor
                    container.style.display = 'flex';
                    container.style.flexDirection = 'column';
                    container.style.gap = '0.1rem';
                    container.style.lineHeight = '1';
                    
                    // Reducir espaciado en elementos consecutivos
                    const formElements = container.querySelectorAll('form > *, div > *');
                    formElements.forEach(function(element, index) {
                      if (index > 0) {
                        element.style.marginTop = '0.1rem';
                      }
                    });
                    
                    // Ocultar mensajes de error específicos de forma menos agresiva
                    const hideElement = function(element) {
                      if (element && element.style) {
                        // Solo ocultar, no eliminar del DOM para evitar errores de PayPal
                        element.style.display = 'none';
                        element.style.visibility = 'hidden';
                        element.style.opacity = '0';
                        element.style.height = '0';
                        element.style.overflow = 'hidden';
                        element.style.position = 'absolute';
                        element.style.left = '-9999px';
                      }
                    };
                    
                    // Buscar y ocultar elementos específicos sin eliminarlos
                    const errorSelectors = [
                      '#amount-decimal-err',
                      '#amount-decimalplaces-err',
                      '.error-label',
                      'span[id*="decimal"]',
                      'span[id*="amount-err"]',
                      '*[class*="error-label"]'
                    ];
                    
                    errorSelectors.forEach(function(selector) {
                      try {
                        const elements = container.querySelectorAll(selector);
                        elements.forEach(hideElement);
                      } catch (selectorError) {
                        console.log('Error con selector:', selector, selectorError);
                      }
                    });
                    
                    console.log('Texto PayPal modificado y errores ocultados (sin eliminar DOM)');
                  } catch (e) {
                    console.log('No se pudo modificar el contenido PayPal:', e);
                  }
                }, 1000);
              })
              .catch(function(err) {
                console.warn('Error al renderizar botón PayPal:', err);
                if (wrapper) wrapper.classList.remove('loading');
                // Reintentar después de 2 segundos
                setTimeout(initPayPal, 2000);
              });
            } catch (error) {
              console.warn('Error en inicialización PayPal:', error);
              if (wrapper) wrapper.classList.remove('loading');
              // Reintentar después de 2 segundos
              setTimeout(initPayPal, 2000);
            }
          } else {
            // Reintentar después de 500ms si PayPal no está listo
            setTimeout(initPayPal, 500);
          }
        }
        
        // Inicializar cuando esté listo
        initPayPal();
      });
    </script>
    
    <!-- Script para suprimir warnings específicos de PayPal que no afectan la funcionalidad -->
    <script>
      // Interceptar y filtrar warnings de PayPal en desarrollo
      const originalError = console.error;
      const originalWarn = console.warn;
      
      console.error = function(...args) {
        const message = args.join(' ');
        // Filtrar errores específicos de PayPal que no afectan la funcionalidad
        if (message.includes('ncps_standalone_paylater_ineligible') || 
            message.includes('paylater_ineligible') ||
            message.includes('paypal_js_sdk_v5_unhandled_exception') ||
            message.includes('Cannot read properties of null') ||
            message.includes('classList') ||
            message.includes('renderErrors')) {
          return; // No mostrar estos errores
        }
        originalError.apply(console, args);
      };
      
      console.warn = function(...args) {
        const message = args.join(' ');
        // Filtrar warnings relacionados con PayPal
        if (message.includes('ncps_standalone_paylater_ineligible') || 
            message.includes('paylater_ineligible') ||
            message.includes('Pay Later ineligible') ||
            message.includes('paypal_js_sdk')) {
          return; // No mostrar estos warnings
        }
        originalWarn.apply(console, args);
      };
      
      // Interceptar errores no capturados de PayPal
      window.addEventListener('error', function(event) {
        if (event.error && event.error.message && 
            (event.error.message.includes('Cannot read properties of null') ||
             event.error.message.includes('classList') ||
             event.error.message.includes('renderErrors') ||
             event.filename && event.filename.includes('paypal.com'))) {
          event.preventDefault();
          return true;
        }
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
