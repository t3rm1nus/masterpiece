<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React</title>
    <!-- PayPal SDK Script -->
    <script
      src="https://www.paypal.com/sdk/js?client-id=BAArspW7KDEKg5gwovm8GgU9VyFznam0pK8opZaMXusHM_4ykQsGvLInGZv_vu5J9DDrqXIMHnlBmGWubw&components=hosted-buttons&disable-funding=venmo&currency=EUR" 
      crossorigin="anonymous" 
      async>
    </script>
    
    <!-- PayPal Button Initialization Script -->
    <script>
      document.addEventListener("DOMContentLoaded", (event) => {
        // Función para inicializar PayPal cuando esté disponible
        function initPayPal() {
          const container = document.getElementById("paypal-container-MRSQEQV646EPA");
          const wrapper = document.getElementById("paypal-button-wrapper");
          
          if (window.paypal && window.paypal.HostedButtons && container) {
            // Marcar como cargando
            if (wrapper) wrapper.classList.add('loading');
            
            // Limpiar el contenedor antes de renderizar
            container.innerHTML = '';
            
            try {
              paypal.HostedButtons({
                hostedButtonId: "MRSQEQV646EPA"
              })
              .render("#paypal-container-MRSQEQV646EPA")
              .then(function() {
                // Marcar como cargado cuando termine
                if (wrapper) {
                  wrapper.classList.remove('loading');
                  wrapper.classList.add('loaded');
                }
                console.log('Botón PayPal renderizado correctamente');
                
                // Aplicar estilos optimizados
                setTimeout(function() {
                  try {
                    // Configuración básica del contenedor
                    container.style.cssText = `
                      display: flex !important;
                      flex-direction: column !important;
                      gap: 8px !important;
                      width: 100% !important;
                      max-width: 300px !important;
                      margin: 0 auto !important;
                      text-align: center !important;
                    `;
                    
                    // Ocultar checkout-button si existe
                    const hideCheckoutButton = function() {
                      const checkoutButton = document.getElementById('checkout-button');
                      if (checkoutButton) {
                        checkoutButton.style.cssText = 'display: none !important; visibility: hidden !important; height: 0 !important; position: absolute !important; left: -9999px !important;';
                        console.log('Botón checkout-button ocultado');
                      }
                    };
                    hideCheckoutButton();
                    setTimeout(hideCheckoutButton, 1000);
                    
                    // Función para aplicar estilos móviles específicos
                    const applyMobilePayPalFixes = function() {
                      if (window.innerWidth <= 768) {
                        console.log('Aplicando correcciones móviles PayPal...');
                        
                        // 1. Forzar layout vertical en móviles - contenedor principal
                        const mainDiv = container.querySelector('div');
                        if (mainDiv) {
                          mainDiv.style.cssText = `
                            display: flex !important;
                            flex-direction: column !important;
                            align-items: center !important;
                            gap: 6px !important;
                            width: 100% !important;
                            max-width: 280px !important;
                            margin: 0 auto !important;
                          `;
                        }
                        
                        // 2. Hacer que TODOS los elementos sean block y centrados
                        const allElements = container.querySelectorAll('*');
                        allElements.forEach(function(element) {
                          if (element.id !== 'checkout-button' && 
                              element.style.display !== 'none' &&
                              !element.closest('#checkout-button')) {
                            
                            // Resetear orientación de texto
                            element.style.writingMode = 'horizontal-tb';
                            element.style.textOrientation = 'mixed';
                            element.style.direction = 'ltr';
                            
                            // Forzar display block y centrado
                            if (element.tagName === 'SPAN' || element.tagName === 'LABEL' || 
                                element.tagName === 'IMG' || element.tagName === 'INPUT') {
                              element.style.cssText += `
                                display: block !important;
                                width: auto !important;
                                max-width: 100% !important;
                                margin: 3px auto !important;
                                text-align: center !important;
                                clear: both !important;
                                float: none !important;
                                line-height: 1.3 !important;
                                overflow: visible !important;
                                white-space: nowrap !important;
                              `;
                            }
                            
                            // Estilos específicos para botones
                            if (element.tagName === 'BUTTON') {
                              element.style.cssText += `
                                display: block !important;
                                width: 100% !important;
                                max-width: 280px !important;
                                height: auto !important;
                                min-height: 44px !important;
                                margin: 4px auto !important;
                                border-radius: 6px !important;
                                text-align: center !important;
                                font-size: 14px !important;
                                line-height: 1.3 !important;
                              `;
                            }
                            
                            // Estilos específicos para iframes
                            if (element.tagName === 'IFRAME') {
                              element.style.cssText += `
                                display: block !important;
                                width: 100% !important;
                                max-width: 280px !important;
                                margin: 4px auto !important;
                                border-radius: 6px !important;
                                min-height: 44px !important;
                              `;
                            }
                          }
                        });
                        
                        // 3. Correcciones específicas para elementos problemáticos
                        
                        // Labels de texto (como "¡Gracias por el coffee!")
                        const textLabels = container.querySelectorAll('label, .input-label, span[class*="label"]');
                        textLabels.forEach(function(label) {
                          label.style.cssText += `
                            display: block !important;
                            width: auto !important;
                            max-width: 100% !important;
                            margin: 4px auto !important;
                            text-align: center !important;
                            font-size: 12px !important;
                            line-height: 1.4 !important;
                            padding: 2px 4px !important;
                            overflow: visible !important;
                            white-space: nowrap !important;
                            color: inherit !important;
                          `;
                        });
                        
                        // Currency labels (como "EUR")
                        const currencySpans = container.querySelectorAll('span[class*="currency"], .currency-label');
                        currencySpans.forEach(function(span) {
                          span.style.cssText += `
                            display: block !important;
                            width: auto !important;
                            margin: 4px auto !important;
                            text-align: center !important;
                            font-size: 12px !important;
                            font-weight: bold !important;
                            line-height: 1.4 !important;
                            overflow: visible !important;
                            white-space: nowrap !important;
                          `;
                        });
                        
                        // Imágenes (logos de PayPal y tarjetas)
                        const images = container.querySelectorAll('img');
                        images.forEach(function(img) {
                          img.style.cssText += `
                            display: block !important;
                            width: auto !important;
                            max-width: 100px !important;
                            height: auto !important;
                            max-height: 24px !important;
                            margin: 6px auto !important;
                            text-align: center !important;
                            clear: both !important;
                            float: none !important;
                          `;
                          
                          // Estilos específicos para iconos de tarjetas
                          if (img.src && (img.src.includes('Debit_Credit_APM') || img.src.includes('card'))) {
                            img.style.cssText += `
                              max-width: 120px !important;
                              margin-top: 8px !important;
                            `;
                          }
                        });
                        
                        // 4. Forzar que ningún elemento tenga float o position que cause problemas
                        const problematicElements = container.querySelectorAll('*');
                        problematicElements.forEach(function(element) {
                          if (element.id !== 'checkout-button') {
                            element.style.cssText += `
                              float: none !important;
                              position: relative !important;
                              transform: none !important;
                            `;
                          }
                        });
                        
                        console.log('✅ Correcciones móviles PayPal aplicadas');
                      }
                    };
                    
                    // Aplicar correcciones inmediatamente y con retraso
                    applyMobilePayPalFixes();
                    setTimeout(applyMobilePayPalFixes, 1000);
                    setTimeout(applyMobilePayPalFixes, 2000);
                    setTimeout(applyMobilePayPalFixes, 3000);
                    
                    // También aplicar al redimensionar la ventana
                    window.addEventListener('resize', function() {
                      setTimeout(applyMobilePayPalFixes, 100);
                    });
                    
                  } catch (e) {
                    console.log('Error aplicando estilos PayPal:', e);
                  }
                }, 500);
              })
              .catch(function(err) {
                console.warn('Error al renderizar botón PayPal:', err);
                if (wrapper) wrapper.classList.remove('loading');
                setTimeout(initPayPal, 2000);
              });
            } catch (error) {
              console.warn('Error en inicialización PayPal:', error);
              if (wrapper) wrapper.classList.remove('loading');
              setTimeout(initPayPal, 2000);
            }
          } else {
            setTimeout(initPayPal, 500);
          }
        }
        
        // Inicializar cuando esté listo
        initPayPal();
      });
    </script>
    
    <!-- Script para suprimir warnings específicos de PayPal que no afectan la funcionalidad -->
    <script>
      // Interceptar y filtrar warnings de PayPal en desarrollo
      const originalError = console.error;
      const originalWarn = console.warn;
      
      console.error = function(...args) {
        const message = args.join(' ');
        // Filtrar errores específicos de PayPal que no afectan la funcionalidad
        if (message.includes('ncps_standalone_paylater_ineligible') || 
            message.includes('paylater_ineligible') ||
            message.includes('paypal_js_sdk_v5_unhandled_exception') ||
            message.includes('Cannot read properties of null') ||
            message.includes('classList') ||
            message.includes('renderErrors')) {
          return; // No mostrar estos errores
        }
        originalError.apply(console, args);
      };
      
      console.warn = function(...args) {
        const message = args.join(' ');
        // Filtrar warnings relacionados con PayPal
        if (message.includes('ncps_standalone_paylater_ineligible') || 
            message.includes('paylater_ineligible') ||
            message.includes('Pay Later ineligible') ||
            message.includes('paypal_js_sdk')) {
          return; // No mostrar estos warnings
        }
        originalWarn.apply(console, args);
      };
      
      // Interceptar errores no capturados de PayPal
      window.addEventListener('error', function(event) {
        if (event.error && event.error.message && 
            (event.error.message.includes('Cannot read properties of null') ||
             event.error.message.includes('classList') ||
             event.error.message.includes('renderErrors') ||
             event.filename && event.filename.includes('paypal.com'))) {
          event.preventDefault();
          return true;
        }
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
